<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />






  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/izitoast/dist/css/iziToast.min.css">



  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/izitoast/dist/js/iziToast.min.js"></script>




  <title>new</title>
  <link rel="stylesheet" href="styles.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">





  <meta name="google-site-verification" content="k-n2zj8pRuIJhpUe2tocb-EDER6zJShpa33TBnGmK6s" />



  <!-- تضمين ملف JavaScript الخاص بـ iziToast -->


















</head>

<body>





  <div class="container">
    <!-- قسم المصادقة -->
    <div class="auth-section" id="authSection">
      <h1 style="text-align: center; margin-bottom: 1.5rem">
        <i class="fa-solid fa-users-gear" style="font-size: 2rem; color: rgb(75, 75, 238)"></i>
        اهلا بكم في MUHASIBI
      </h1>

      <h2 style="text-align: center; margin-bottom: 1.5rem">
        <i class="fas fa-id-card" style="font-size: 2rem; color: rgb(244, 96, 131)"></i>
        تسجيل الدخول
      </h2>
      <div class="input-group">
        <input type="email" id="email" placeholder="البريد الإلكتروني" autocomplete="email">
      </div>
      <div class="input-group">
        <input type="password" id="password" placeholder="كلمة المرور" />
      </div>
      <div style="display: flex; gap: 1rem; margin-top: 1.5rem">
        <button class="btn btn-primary" onclick="login()">
          <i class="fas fa-sign-in-alt"></i> تسجيل الدخول
        </button>

        <button class="btn btn-success" onclick="register()">
          <i class="fas fa-user-plus"></i> تسجيل جديد
        </button>
      </div>
    </div>
  </div>
  <!-- قسم الصفحة الرئيسية -->
  <div class="dashboard" id="dashboard">



    <!-- From Uiverse.io by Nawsome -->
    <div class="loader-container" id="loader">
      <h1 style="color: rgb(113, 113, 255); ">MUHASIBI...</h1>
      <div class="typewriter">
        <div class="paper"></div>
        <div class="slide"><i></i></div>
        <div class="keyboard"></div>
      </div>
    </div>


    <div class="page2">










      <div class="menu" id="menu">

        <div class="min-bar">

          <button class="btn2" onclick="showContent1()"><i class="fa-solid fa-house"></i></button>
          <button class="btn2" onclick="showContent2()"><i class="fa-solid fa-circle-user"></i></button>
          <button class="btn2" onclick="showContent('content3')"><i class="fa-solid fa-calendar-days"></i></button>
          <button class="btn2" onclick="showContent('content4')"><i class="fa-solid fa-box"></i></button>

        </div>


        <div id="content2" class="menu2">

          <button class="btn " onclick="addCustomer()" style="margin: 10px;">
            <i class="fa-solid fa-user-plus"></i>
          </button>
          <div class="sersh"><input type="text" id="searchInput" placeholder="ابحث هنا..." oninput="searchList()"></div>
          <ul class="customer-list" id="customersList"></ul>


          <li class="logout" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i>

          </li>





        </div>






      </div>




      <!-- ////////////////////////////////// -->







      <div class="state" id="state">
        <div class="openmenuclick">
          <li class="logo"><a href="#"><i class="fa-solid fa-bars" id="openmenu" onclick="openmenu()"></i>
              
            </a></li>
            <p>MUHASIBI</p>
            <button class="btn" id="themeToggle">تبديل الوضع</button>

     
        </div>
         




        <div class="data-info-page" id="content1">
          <h1 style="color: var(--text);">الاحصائيات</h1>
          <!-- المعلومات الرئيسية -->
          <div class="data-info">

            <div class="box">
              <img src="image/user.webp" alt=" " width="100px" height="100px"
                style="padding: 10px;">
              <div class="data">
                <p>عدد الزبائن</p>
                <hr>

                <span id="counter">⏳</span>
              </div>
            </div>
            <div class="box">
              <img src="image/many.png" alt=" " width="150px" height="150px"
                style="padding: 10px;">
              <div class="data">
                <p>اجمالي الديون</p>
                <hr>

                <h3>ديون : <span id="totalDebt" style="color: rgb(2, 161, 26);">ليرة</span> </h3>
                <h3>مديون لهم : <span id="totalCredit" style="color: red;"></span> </h3>



              </div>
            </div>
            <div id="stats-container" class="box">
              <img src="image/statistics.png" alt=" " width="100px" height="100px"
                style="padding: 10px;">
              <div class="data">

                <p>الاحصائيات</p>
                <hr>
                <h3>مديونين : <span id="debtorsCount"></span> </h3>
                <h3>غير مديونين : <span id="nonDebtorsCount"></span> </h3>
                <h3>مديون لهم : <span id="creditorsCount"></span> </h3>

              </div>
            </div>


          </div>


        </div>









        <!-- المحتوى الرئيسي -->
        <div class="main-content">







          <div id="customerDetails" style="display: none;">




            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">

              <div id="selectedCustomerName" style="cursor: pointer; "></div>




              <button class="btn1" onclick="closeCustomerDetails()">
                <i class="fas fa-times"></i>
              </button>


            </div>

            <div class="input-group">
              <input type="number" id="amountInput" placeholder="المبلغ" onkeypress="handleEnter(event)">

            </div>

            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
              <button class="btn btn-success" onclick="addTransaction('credit')">
                <i class="fas fa-plus"></i> إضافة دين
              </button>
              <button class="btn btn-danger" onclick="addTransaction('debit')">
                <i class="fas fa-minus"></i> خصم دين
              </button>

            </div>

            <button onclick="printDiv('transactionsList')" class="btn2" style="margin-bottom: 12px;"><i
                class="fa-solid fa-print"></i></button>
            <h4><i class="fas fa-history"></i> سجل المعاملات</h4>
            <p class="balance" id="balance">0:المجموع</p>

            <button class="btn" onclick="deleteALLTransaction('transaction-id')" style="margin-top: 10px;">حذف
              المعاملة</button>

            <ul id="transactionsList"></ul>
          </div>
        </div>

      </div>



















    </div>

















  </div>



  </div>


  </div>



  <script>

    //زر القائمة
    function openmenu() {
      const div = document.getElementById("menu");
      const openmenu = document.getElementById("openmenu");

      div.style.display = (div.style.display === "none" || div.style.display === "") ? "block" : "none";



      // عند النقر في أي مكان خارج القائمة، يتم إخفاؤها
      document.addEventListener("click", (event) => {
        if (!menu.contains(event.target) && event.target !== openmenu) {
          menu.style.display = "none";
        }
      });

    }


    //اليحث عن زبون
    function searchList() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const items = document.querySelectorAll('#customersList li');

      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
          item.style.display = ''; // يظهر العنصر إذا كان يحتوي على النص المدخل
        } else {
          item.style.display = 'none'; // يخفي العنصر إذا كان لا يحتوي على النص المدخل
        }
      });
    }


    //الخروج من المستخدم
    function closeCustomerDetails() {
      document.getElementById('customerDetails').style.display = 'none';
      selectedCustomer = null;
    }


    //زر طباعة الديون


    function printDiv(id) {
      const container = document.getElementById(id);
      const elements = container.querySelectorAll('span, small');

      // الحصول على اسم المستخدم من العنصر h3
      const customerNameElement = document.getElementById('selectedCustomerName');
      const customerName = customerNameElement ? customerNameElement.textContent : '';

      let content = `
    <style>
      .customer-name {
        text-align: center;
        font-size: 20px;
        margin-bottom: 30px;
        border-bottom: 2px solid #000;
        padding-bottom: 10px;
      }
      .print-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 10px 0;
        width: 100%;
      }
      .print-row span {
        font-size: 16px;
        flex-grow: 1;
      }
      .print-row small {
        color: #666;
        margin-left: 100px;
        white-space: nowrap;
      }
    </style>
    <div class="customer-name">${customerName}</div>
  `;

      // إضافة العناصر
      for (let i = 0; i < elements.length; i += 2) {
        content += `
      <div class="print-row">
        ${elements[i].outerHTML}
        ${elements[i + 1]?.outerHTML || ''}
      </div>
    `;
      }

      // محاولة فتح نافذة الطباعة
      const printWindow = window.open('', '', 'height=700,width=900');

      // إذا تم حظر النافذة المنبثقة
      if (!printWindow) {
        alert("تم حظر النوافذ المنبثقة من المتصفح. من فضلك، قم بتمكين النوافذ المنبثقة لهذا الموقع.\n\nإليك كيفية تمكين النوافذ المنبثقة:\n\n1. في متصفح Chrome: اذهب إلى إعدادات > الخصوصية والأمان > إعدادات المواقع > النوافذ المنبثقة والإعلانات > إضافة الموقع إلى قائمة السماح.\n2. في متصفح Firefox: اذهب إلى إعدادات > الخصوصية والأمان > النوافذ المنبثقة > السماح بالنوافذ المنبثقة لهذا الموقع.");
        return;
      }

      // كتابة المحتوى في نافذة الطباعة
      printWindow.document.open();
      printWindow.document.write(content);
      printWindow.document.close();

      // الطباعة وإغلاق النافذة
      printWindow.onload = function () {
        printWindow.print();
        printWindow.close();
      };
    }











    //شاشة التحميل
    const loader = document.getElementById('loader');
    const dashboard = document.getElementById('dashboard');

    // إنشاء المراقب
    const observer = new MutationObserver(() => {
      const displayStyle = window.getComputedStyle(dashboard).display;

      if (displayStyle === 'grid') {
        // إخفاء اللودر عندما يصبح الداشبورد grid
        setTimeout(() => {
          loader.style.display = 'none';

        }, 500); // نفس مدة transition
      }
    });


    // إعدادات المراقبة (نراقب تغيّر الـ style attribute)
    observer.observe(dashboard, { attributes: true, attributeFilter: ['style'] });


    // اظهار DATA-INFO
    function showContent1() {
      // إخفاء جميع العناصر
      document.getElementById("content1").style.display = 'block';
      document.getElementById("content2").style.display = 'none';
      document.getElementById("customerDetails").style.display = 'none';


      // إظهار العنصر المطلوب
    }
    // اظهار menu2
    function showContent2() {
      // إخفاء جميع العناصر
      document.getElementById("content2").style.display = 'block';
      document.getElementById("content1").style.display = 'none';


      // إظهار العنصر المطلوب
    }


    //عرض اسم الزبون والتفاصيل توسيع
    function ashowCustomerDetails(customerData) {
      const container = document.getElementById('selectedCustomerName');

      // محتوى الاسم فقط أولًا مع إضافة علامة التوثيق بجانب الاسم
      let verificationIcon = '';
      if (customerData.verification === 'blue') {
        verificationIcon = '<img  src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Twitter_Verified_Badge.svg/2048px-Twitter_Verified_Badge.svg.png" alt=""  width="30px" height="30px">'; // توثيق أزرق
      } else if (customerData.verification === 'silver') {
        verificationIcon = '<img src="https://www.svgrepo.com/show/528774/verified-check.svg" alt=""  width="30px" height="30px">';  // توثيق فضي
      }

      container.innerHTML = `
    <div style="display: flex; align-items: center;">
      <i class="fa-solid fa-circle-info"></i>
      <strong>الاسم:</strong> ${customerData.name}
      ${verificationIcon} <!-- عرض علامة التوثيق بجانب الاسم -->
      <span id="arrow" style="cursor: pointer; margin-left: 10px;">
        <i class="fa-solid fa-circle-up"></i>
      </span>
    </div>
  `;

      // إنشاء تفاصيل إضافية داخل div مخفي
      const detailsDiv = document.createElement('div');
      detailsDiv.style.maxHeight = '0';
      detailsDiv.style.overflow = 'hidden';
      detailsDiv.style.transition = 'max-height 0.5s ease, padding 0.3s ease';
      detailsDiv.style.marginLeft = '20px'; // إضافة مسافة بين الاسم والتفاصيل
      detailsDiv.innerHTML = `
    <p><strong>رقم الهاتف:</strong> ${customerData.phone || '---'}</p>
    <p><strong>العنوان:</strong> ${customerData.address || '---'}</p>
    <p><strong>الملاحظة:</strong> ${customerData.note || '---'}</p>

    <button class="btn1" onclick="editCustomer('${customerData.id}', {
      name: '${customerData.name} ',
      phone: '${customerData.phone || ''}',
      address: '${customerData.address || ''}',
      note: '${customerData.note || ''}'
    })">
      <i class="fas fa-edit"></i>
    </button>
  `;

      container.appendChild(detailsDiv);

      // السهم الذي سنغير اتجاهه عند النقر
      const arrow = document.getElementById('arrow');

      // عند النقر على الاسم، توسع أو تطوي التفاصيل مع تغيير اتجاه السهم
      container.onclick = () => {
        if (detailsDiv.style.maxHeight === '0px' || detailsDiv.style.maxHeight === '0') {
          detailsDiv.style.maxHeight = '200px';
          detailsDiv.style.paddingTop = '10px';
          arrow.innerHTML = '<i class="fa-solid fa-circle-down"></i>'; // تغيير السهم إلى الأسفل
        } else {
          detailsDiv.style.maxHeight = '0';
          detailsDiv.style.paddingTop = '0';
          arrow.innerHTML = '<i class="fa-solid fa-circle-up"></i>'; // تغيير السهم إلى الأعلى
        }
      };
    }






    //الاوضاع داكن فاتح
    const toggleButton = document.getElementById('themeToggle');
    let isDark = localStorage.getItem('theme') === 'dark';

    // دالة لتطبيق الوضع
    function applyTheme() {
      if (isDark) {
        document.documentElement.style.setProperty('--light', 'rgb(39, 40, 42)');
        document.documentElement.style.setProperty('--light2', ' #000000');
        document.documentElement.style.setProperty('--text', '#ffffff');
        iziToast.success({ title: 'الوضع الليلي',timeout: 1000 });
        localStorage.setItem('theme', 'dark');
      } else {
        document.documentElement.style.setProperty('--light', '#ffffff');
        document.documentElement.style.setProperty('--light2', '#ffffff');

        document.documentElement.style.setProperty('--text', '#000000');
        iziToast.success({ title: 'الوضع النهاري',timeout: 1000  });
        localStorage.setItem('theme', 'light');
      }
    }

    // أول مرة عند تحميل الصفحة (تطبق الوضع حسب ما هو مخزن)
    applyTheme();

    // عند الضغط على الزر
    toggleButton.addEventListener('click', () => {
      isDark = !isDark;
      applyTheme();
    });









  </script>
  <script type="module" src="app.js"></script>


</body>






</html>